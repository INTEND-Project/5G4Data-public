{% extends "base.html" %}

{% block content %}
    <div class="container">
        <div class="map-container">
            <div id="map"></div>
        </div>
    </div>
    <div class="container">
        <div class="info-container" style="max-width: 750px;">
            <h1>INTEND 5G4Data Infrastructure</h1>
            <p>
                The 5G4Data use case (UC) is a futuristic view of how Telco operators infrastructure might look like in the future. We have generated synthetic data for this foreseen infrastructure. In the map above, the markers indicate where the Edge data centers for the 5G4Data use case are located. It is possible to click on the markers to get more details about the datacentre at that location. 
            </p>
            <p>    
                The 5G4Data UC explores how 5G networks and connected Edge data centres can support an intent-based data pipeline continuum. It aims to demonstrate how natural language intents from customers can drive automated network configuration and workload deployment, with a focus on Quality of Service (QoS) assurance. 
            </p>
                
            <p>
                The use case leverages deployment of containerized workloads to Edge data centres to achieve performance characteristics that centralized computing cannot provide. A key aspect of the use-case is the dynamic provisioning of network slices, ensuring that decentralized workloads receive dedicated network resources optimized for the customer's needs. This guarantees that for example real-time inference applications can function without disruptions and with privacy in mind, thus addressing critical performance requirements not possible to achieve in centralized cloud-based solutions. To complement the network slicing capabilities, containerized workloads are deployed in container environments at Edge data centres, significantly reducing the distance between data sources (UEs) and processing nodes. This approach minimizes response times compared to traditional cloud-based inference, making real-time applications feasible across various domains.
            </p>
            <!-- More Details Button -->
            <div class="button-row" style="display: flex; gap: 10px; margin-top: 1em;">
                <button class="more-details-btn" onclick="openModal()">More details</button>
            </div>
            <p></p>
            <p>The use case is all about configuring the 5G network to meet needed requirements for an application that is accesed from devices connected to a 5G network (e.g. Mobile phones, AR Goggles, IoT devices, Drones). In order to meet the latency needs of an application it might be needed to deploy or move the application to an Edge datacenter. A user expresses what their goal is in natural language using the inChat tool and inChat needs to find out what type of intent is needed. For this use case, two types of intents are possible: a) Intents that results in configuration of the 5G network using a slice, b) Deployement of an application to an edge datacenter. The combination of the two is also possible. inChat needs to figure out if a) or b) or a combination of the two are needed. Click the next button to know more about how this can be done.</p>
            <div class="next-step-container">
                <div class="button-row" style="display: flex; gap: 10px; margin-top: 1em;">
                    <a href="{{ url_for('first_step') }}" class="next-step-button">Next Step</a>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal for displaying markdown -->
    <div id="markdownModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">âœ–</button>
            <h3>More Details</h3>
            <div id="markdownContent">Loading...</div>
        </div>
    </div>

    <script>
        // Initialize Leaflet Map
        var map = L.map("map").setView([65, 19], 4);
        
        // Add OpenStreetMap tile layer
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            attribution: "&copy; OpenStreetMap contributors"
        }).addTo(map);

        // Function to load and parse CSV data
        function loadCSV(csvFile) {
            Papa.parse(csvFile, {
                download: true,
                header: true,
                delimiter: ";",
                complete: function(results) {
                    addMarkers(results.data);
                }
            });
        }

        // Function to add markers from CSV data
        function addMarkers(data) {
            data.forEach(function(row) {
                if (!row.Latitude || !row.Longitude || !row.City) return; // Skip invalid rows
                
                var lat = parseFloat(row.Latitude);
                var lon = parseFloat(row.Longitude);
                
                var popupContent = `
                    <b>City:</b> ${row.City}<br>
                    <b>Cluster ID:</b> ${row.Cluster_ID}<br>
                    <b>GPUs:</b> ${row.GPUs}<br>
                    <b>CPUs:</b> ${row.CPUs}<br>
                    <b>Memory:</b> ${row.Memory}<br>
                    <b>Major Electricity Source:</b> ${row.Major_source_of_electricity}<br>
                    <b>Cost of Compute:</b> ${row.Cost_of_compute}<br>
                    <a href="${row.Access}" target="_blank">Access Edge API</a>
                `;

                var marker = L.marker([lat, lon]).addTo(map);
                marker.bindPopup(popupContent);
                marker.bindTooltip(row.City, { sticky: true });
            });
        }
        function openModal() {
            document.getElementById("markdownModal").style.display = "flex";

            fetch("{{ url_for('static', filename='markdown/mvs.md') }}")
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(markdown => {
                    document.getElementById("markdownContent").innerHTML = marked.parse(markdown);
                })
                .catch(error => {
                    console.error("Error loading markdown:", error);
                    document.getElementById("markdownContent").innerHTML = "Error loading details. Check console for more information.";
                });
        }

        function closeModal() {
            document.getElementById("markdownModal").style.display = "none";
        }

        // Load the CSV file (must be in the same directory as the HTML file)
        loadCSV("static/5G4Data_Nordic_Edge_Datacenters.csv");

        // Close the modal when clicking outside of it
        window.onclick = function(event) {
            let modal = document.getElementById("markdownModal");
            if (event.target === modal) {
                modal.style.display = "none";
            }
        }
    </script>
{% endblock %}
